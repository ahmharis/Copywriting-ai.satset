<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Generator Copywriting</title>
    <script src="https://cdn-tailwindcss.vercel.app/"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        /* Gaya kustom dari file referensi */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #050a30; /* Latar Belakang: BIRU SANGAT GELAP */
            color: #e5e7eb; /* Teks default: PUTIH/TERANG (gray-200) */
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f2fd8; /* Latar kartu (Biru Cerah) */ }
        ::-webkit-scrollbar-thumb { background: #38bdf8; /* Warna scroll (Biru Cyan) */ border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #0ea5e9; /* Cyan lebih gelap */ }
        input::placeholder, textarea::placeholder { color: #9ca3af; opacity: 1; }
        select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; -webkit-appearance: none; -moz-appearance: none; appearance: none; padding-right: 2.5rem; }
    </style>
</head>
<body class="text-gray-200">

    <div class="min-h-screen p-4 md:p-8">
        <div class="max-w-7xl mx-auto">
            
            <!-- HEADER (Logo dan Judul) -->
            <header class="text-center mb-10">
                <div class="flex justify-center items-center gap-4 mb-4">
                    <!-- Logo SVG AI Satset -->
                    <div class="flex-shrink-0 bg-[#0f2fd8] p-3 rounded-2xl shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1080 1080" class="w-16 h-16">
                            <g><path style="opacity:1" fill="#f7fa1a" d="M 530.5,241.5 C 553.637,238.99 571.47,247.324 584,266.5C 597.929,295.935 612.096,325.268 626.5,354.5C 570.609,414.554 514.942,474.721 459.5,535C 459.905,535.945 460.572,536.612 461.5,537C 480.547,541.512 499.547,546.178 518.5,551C 520.286,551.196 521.619,552.029 522.5,553.5C 489.667,613.476 455.833,672.81 421,731.5C 425.794,711.089 430.628,690.589 435.5,670C 433.919,652.824 425.585,640.157 410.5,632C 364.86,610.513 319.527,588.513 274.5,566C 259.169,551.669 253.669,534.169 258,513.5C 261.449,501.439 268.616,492.273 279.5,486C 322.136,465.349 364.802,444.683 407.5,424C 417.623,417.544 426.123,409.377 433,399.5C 454.744,354.346 476.744,309.346 499,264.5C 506.987,253.269 517.487,245.603 530.5,241.5 Z"/></g>
                            <g><path style="opacity:1" fill="#f7fa19" d="M 612.5,517.5 C 610.485,516.076 608.152,515.41 605.5,515.5C 591.538,513.176 577.871,509.843 564.5,505.5C 596.611,445.948 629.778,386.948 664,328.5C 659.517,347.961 655.017,367.461 650.5,387C 651.774,403.551 659.441,416.218 673.5,425C 718.566,446.202 763.233,467.868 807.5,490C 827.579,509.406 831.079,531.573 818,556.5C 814.167,561.667 809.667,566.167 804.5,570C 763.073,590.713 721.74,611.38 680.5,632C 668.086,639.746 657.586,649.579 649,661.5C 626.054,709.06 602.387,756.06 578,802.5C 556.829,822.487 533.996,824.654 509.5,809C 505.631,805.466 502.131,801.633 499,797.5C 484.124,768.246 469.624,738.746 455.5,709C 512.602,646.061 570.269,583.561 628.5,521.5C 623.188,520.038 617.855,518.705 612.5,517.5 Z"/></g>
                            <g><path style="opacity:1" fill="#9f9881" d="M 605.5,515.5 C 608.152,515.41 610.485,516.076 612.5,517.5C 609.848,517.59 607.515,516.924 605.5,515.5 Z"/></g>
                        </svg>
                    </div>
                    <!-- Teks Branding (Sudah diperbarui) -->
                    <div class="text-left">
                        <h2 class="text-3xl font-bold text-gray-100">AI Satset</h2>
                        <p class="text-base text-gray-400">Divisi Strategi Komunikasi v 1.0</p>
                    </div>
                </div>

                <!-- Judul & Deskripsi -->
                <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-200">
                    Generator Copywriting AI ✍️
                </h1>
                <p class="text-base md:text-lg text-gray-300 mt-3 max-w-3xl mx-auto">
                    Buat naskah iklan, caption media sosial, atau skrip video yang menjual hanya dalam hitungan detik.
                </p>
            </header>

            <!-- KONTEN UTAMA -->
            <main class="grid md:grid-cols-2 gap-6 md:gap-8">

                <!-- KARTU KIRI (INPUT) -->
                <div class="bg-[#0f2fd8] p-6 rounded-2xl shadow-2xl border border-blue-800 space-y-5">
                    
                    <div>
                        <label for="form-deskripsi" class="block text-sm font-medium text-gray-300 mb-1">Deskripsikan produk/topik Anda:</label>
                        <textarea id="form-deskripsi" rows="4" class="w-full bg-[#0f1d42] border border-blue-700 rounded-lg p-2.5 text-gray-100 placeholder-gray-400 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="Contoh: Kopi bubuk Robusta premium..."></textarea>
                    </div>
                    <div>
                        <label for="form-target" class="block text-sm font-medium text-gray-300 mb-1">Target Penonton/Audiens:</label>
                        <textarea id="form-target" rows="2" class="w-full bg-[#0f1d42] border border-blue-700 rounded-lg p-2.5 text-gray-100 placeholder-gray-400 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="Contoh: Mahasiswa, pekerja kantoran..."></textarea>
                    </div>
                    <div>
                        <label for="form-cta" class="block text-sm font-medium text-gray-300 mb-1">CTA (Call to Action) / Goals:</label>
                        <textarea id="form-cta" rows="2" class="w-full bg-[#0f1d42] border border-blue-700 rounded-lg p-2.5 text-gray-100 placeholder-gray-400 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="Contoh: Ajak untuk membeli..."></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="form-peruntukan" class="block text-sm font-medium text-gray-300 mb-1">Peruntukan</label>
                            <select id="form-peruntukan" class="w-full bg-[#0f1d42] border border-blue-700 rounded-lg p-2.5 text-gray-100 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm"></select>
                        </div>
                        <div>
                            <label for="form-formula" class="block text-sm font-medium text-gray-300 mb-1">Formula</label>
                            <select id="form-formula" class="w-full bg-[#0f1d42] border border-blue-700 rounded-lg p-2.5 text-gray-100 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm"></select>
                        </div>
                        <div>
                            <label for="form-hook" class="block text-sm font-medium text-gray-300 mb-1">Hook</label>
                            <select id="form-hook" class="w-full bg-[#0f1d42] border border-blue-700 rounded-lg p-2.5 text-gray-100 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm"></select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="form-bahasa" class="block text-sm font-medium text-gray-300 mb-1">Bahasa</label>
                            <select id="form-bahasa" class="w-full bg-[#0f1d42] border border-blue-700 rounded-lg p-2.5 text-gray-100 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm"></select>
                        </div>
                        <div id="custom-bahasa-container" class="hidden">
                            <label for="form-bahasa-kustom" class="block text-sm font-medium text-gray-300 mb-1">Tulis Bahasa Lainnya:</label>
                            <input type="text" id="form-bahasa-kustom" class="w-full bg-[#0f1d42] border border-blue-700 rounded-lg p-2.5 text-gray-100 placeholder-gray-400 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="Contoh: Bahasa Inggris"/>
                        </div>
                    </div>
                    
                    <div class="pt-2">
                        <button id="generate-button" class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-[#0f2fd8] disabled:opacity-75 disabled:cursor-not-allowed flex items-center justify-center space-x-2">
                            <span>Buat Copywriting</span>
                        </button>
                    </div>
                </div>

                <!-- KARTU KANAN (OUTPUT) -->
                <div class="bg-[#0f2fd8] p-6 rounded-2xl shadow-2xl border border-blue-800 lg:flex lg:flex-col lg:h-full relative">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-4 sm:gap-2">
                        <h2 class="text-xl lg:text-2xl font-bold text-white">Hasil Copywriting:</h2>
                        <button id="copy-button" class="w-full sm:w-auto px-6 py-2 bg-[#0f1d42] hover:bg-opacity-75 text-gray-200 font-bold rounded-lg shadow-lg transition duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 focus:ring-offset-[#0f2fd8] border border-blue-700 text-sm">
                            Salin
                        </button>
                    </div>

                    <!-- Area Output -->
                    <div id="output-container" class="flex-1 rounded-lg p-4 custom-scrollbar min-h-[300px] lg:min-h-0 lg:flex-1 lg:overflow-y-auto border border-blue-700 bg-[#0f1d42]">
                        
                        <div id="loading-spinner" class="flex items-center justify-center h-full hidden">
                            <div class="flex flex-col items-center">
                                <div class="w-12 h-12 border-4 border-cyan-400 border-t-transparent border-solid rounded-full animate-spin"></div>
                                <p class="text-gray-400 mt-4 text-center">AI sedang menulis... Ini mungkin perlu waktu.</p>
                            </div>
                        </div>

                        <div id="output-content" class="text-gray-300" style="white-space: pre-wrap;">
                            <p class="text-gray-500">Hasil copywriting Anda akan muncul di sini...</p>
                        </div>

                    </div>
                </div>
            </main>
            
            <!-- Modal -->
            <div id="modal" class="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 hidden">
                <div class="bg-[#0f1d42] p-6 rounded-2xl shadow-2xl border border-blue-700 max-w-sm w-full mx-4">
                    <h3 id="modal-title" class="text-lg font-bold text-white mb-2"></h3>
                    <p id="modal-message" class="text-sm text-gray-300 mb-4"></p>
                    <button id="modal-close-button" class="w-full bg-cyan-600 text-white py-2 px-4 rounded-lg hover:bg-cyan-700 transition-colors">
                        Tutup
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // === PERUBAHAN PENTING ===
            // API URL sekarang menunjuk ke backend di domain yang sama
            // Ini adalah path RELATIF, bukan 'http://localhost...'
            const apiUrl = '/api/generate';

            // === Konstanta Opsi Form ===
            const purposeOptions = ["Video Reels/Tiktok", "Video Youtube", "Script Teks", "Status Facebook", "Status Threads/X", "Carousel Instagram", "Feed Single Post", "Caption", "Chat WA"];
            const formulaOptions = ["AIDA (Attention, Interest, Desire, Action)", "PAS (Problem, Agitate, Solve)", "FAB (Features, Advantages, Benefits)", "PPPP (Picture, Promise, Prove, Push)", "BAB (Before, After, Bridge)", "The Star-Story-Solution Formula", "ACCA (Awareness, Comprehension, Conviction, Action)", "4C (Clear, Concise, Compelling, Credible)", "GRAB (Gain attention, Relate, Agitate, Bridge)", "PASTOR (Person, Aspiration, Story, Testimony, Offer, Request)", "QUEST (Qualify, Understand, Educate, Stimulate, Transition)", "SLAP (Stop, Look, Act, Purchase)", "AICPBSAWN (Attention, Interest, Credibility, Proof, Benefit, Scarcity, Action, Warn, Now)"];
            const hookOptions = ["Negatif, Positif", "Problem, Solution", "Before, After", "Manfaat Langsung (Direct Benefit)", "Angka atau Daftar (Numbered List)", "Pertanyaan (Question)", "Perintah (Command)", "Rasa Penasaran & Kejutan (Curiosity & Intrigue)", "Berita atau Pengumuman (News/Announcement)", "Bukti Sosial & Testimonial (Social Proof)", "Urgensi & Kelangkaan (Urgency & Scarcity)", "Dulu.., Sekarang..."];
            const languageOptions = ["Bahasa Gen-Z", "Bahasa Indonesia", "Bahasa Jawa (ragam Ngoko)", "Bahasa Jawa (ragam Krama)", "Bahasa Sunda (ragam Loma)", "Bahasa Sunda (ragam Lemes)", "Bahasa Banjar (ragam Kuala)", "Bahasa Banjar (ragam Hulu)", "Bahasa Bali", "Bahasa Batak", "Bahasa Minangkabau", "Bahasa Makassar", "Bahasa Bugis", "Bahasa Aceh", "Bahasa Madura", "Bahasa Melayu", "Bahasa Papua", "Lainnya"];
            const hookDropdownOptions = ["Random", ...hookOptions];

            // === Ambil Elemen DOM ===
            const deskripsiInput = document.getElementById('form-deskripsi');
            const targetInput = document.getElementById('form-target');
            const ctaInput = document.getElementById('form-cta');
            const peruntukanSelect = document.getElementById('form-peruntukan');
            const formulaSelect = document.getElementById('form-formula');
            const hookSelect = document.getElementById('form-hook');
            const bahasaSelect = document.getElementById('form-bahasa');
            const customBahasaContainer = document.getElementById('custom-bahasa-container');
            const customBahasaInput = document.getElementById('form-bahasa-kustom');
            
            const generateButton = document.getElementById('generate-button');
            const copyButton = document.getElementById('copy-button');
            const outputContainer = document.getElementById('output-container');
            const loadingSpinner = document.getElementById('loading-spinner');
            const outputContent = document.getElementById('output-content');
            
            // Modal Elements
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseButton = document.getElementById('modal-close-button');

            // === Fungsi Modal ===
            function showModal(title, message) {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modal.classList.remove('hidden');
            }
            function hideModal() {
                modal.classList.add('hidden');
            }
            modalCloseButton.addEventListener('click', hideModal);
            
            // === Isi Pilihan Dropdown ===
            function populateSelect(selectEl, options) {
                options.forEach(optionText => {
                    const option = document.createElement('option');
                    option.value = optionText;
                    option.textContent = optionText;
                    selectEl.appendChild(option);
                });
            }
            populateSelect(peruntukanSelect, purposeOptions);
            populateSelect(formulaSelect, formulaOptions);
            populateSelect(hookSelect, hookDropdownOptions);
            populateSelect(bahasaSelect, languageOptions);
            bahasaSelect.value = "Bahasa Indonesia"; // Set default

            // === Fungsi API Call (Retry) - DIMODIFIKASI ===
            async function callApi(payload, retryCount = 0) {
                const maxRetries = 5;
                const delay = Math.pow(2, retryCount) * 1000 + Math.random() * 1000;
                try {
                    const response = await fetch(apiUrl, { // apiUrl sekarang ke backend Vercel kita
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload) // Payload sekarang berisi { systemPrompt, userPrompt }
                    });
                    if (!response.ok) {
                        if (response.status === 429 && retryCount < maxRetries) {
                            await new Promise(res => setTimeout(res, delay));
                            return callApi(payload, retryCount + 1);
                        }
                        const errorBody = await response.json();
                        throw new Error(`API error: ${response.status} ${errorBody.error || response.statusText}`);
                    }
                    return await response.json(); // Respons dari backend kita adalah { text: "..." }
                } catch (error) {
                    if (retryCount < maxRetries) {
                        await new Promise(res => setTimeout(res, delay));
                        return callApi(payload, retryCount + 1);
                    }
                    console.error("Gagal memanggil API setelah beberapa kali percobaan:", error);
                    throw error;
                }
            }

            // === Tampilkan/Sembunyikan Input Bahasa Kustom ===
            bahasaSelect.addEventListener('change', () => {
                if (bahasaSelect.value === 'Lainnya') {
                    customBahasaContainer.classList.remove('hidden');
                } else {
                    customBahasaContainer.classList.add('hidden');
                }
            });

            // === Fungsi Generate - DIMODIFIKASI ===
            generateButton.addEventListener('click', async () => {
                const formData = {
                    deskripsi: deskripsiInput.value,
                    target: targetInput.value,
                    cta: ctaInput.value,
                    peruntukan: peruntukanSelect.value,
                    formula: formulaSelect.value,
                    hook: hookSelect.value,
                    bahasa: bahasaSelect.value,
                    bahasaKustom: customBahasaInput.value
                };

                if (!formData.deskripsi || !formData.target || !formData.cta) {
                    showModal("Input Tidak Lengkap", "Mohon lengkapi semua kolom (deskripsi, target audiens, dan CTA).");
                    return;
                }

                // Tampilkan Loading
                loadingSpinner.classList.remove('hidden');
                outputContent.classList.add('hidden');
                generateButton.disabled = true;
                generateButton.querySelector('span').textContent = 'Sedang Membuat...';
                
                let selectedHook = formData.hook;
                if (selectedHook === "Random") {
                    const randomIndex = Math.floor(Math.random() * hookOptions.length);
                    selectedHook = hookOptions[randomIndex];
                }
                let selectedBahasa = formData.bahasa;
                if (formData.bahasa === "Lainnya" && formData.bahasaKustom) {
                    selectedBahasa = formData.bahasaKustom;
                } else if (formData.bahasa === "Lainnya" && !formData.bahasaKustom) {
                    selectedBahasa = "Bahasa Indonesia";
                }

                const systemPrompt = `Anda adalah seorang ahli copywriting profesional berbahasa Indonesia. Tugas Anda adalah membuat copywriting yang memikat, persuasif, dan relevan dengan detail yang diberikan.
                PENTING: Berikan HANYA hasil copywriting yang sudah jadi, siap pakai, TANPA tambahan basa-basi, judul, atau disclaimer. Langsung ke kontennya.`;
                const userPrompt = `
                  Deskripsi Produk/Topik: "${formData.deskripsi}"
                  Target Penonton/Audiens: "${formData.target}"
                  CTA (Call to Action) / Goals: "${formData.cta}"
                  Peruntukan / Platform: ${formData.peruntukan}
                  Formula Copywriting yang Digunakan: ${formData.formula}
                  Gaya Hook (Kail) yang Digunakan: ${selectedHook}
                  Bahasa yang Digunakan: ${selectedBahasa}
                  Buatkan copywritingnya sekarang.
                `;
                
                // === PERUBAHAN PAYLOAD ===
                // Kita kirim prompt ke backend kita, bukan ke Google
                const payload = { systemPrompt, userPrompt };

                try {
                    const data = await callApi(payload);
                    
                    // === PERUBAHAN PARSING ===
                    // Kita terima { text: "..." } dari backend
                    const text = data.text; 
                    
                    if (text) {
                        outputContent.textContent = text.trim(); // Gunakan textContent untuk menjaga format
                    } else {
                        throw new Error("Respon API tidak valid.");
                    }
                } catch (error) {
                    showModal("Error", `Gagal menghasilkan copywriting: ${error.message}`);
                    outputContent.innerHTML = `<p class="text-gray-500">Hasil copywriting Anda akan muncul di sini...</p>`;
                } finally {
                    // Sembunyikan Loading
                    loadingSpinner.classList.add('hidden');
                    outputContent.classList.remove('hidden');
                    generateButton.disabled = false;
                    generateButton.querySelector('span').textContent = 'Buat Copywriting';
                }
            });

            // === Fungsi Copy ===
            copyButton.addEventListener('click', () => {
                const textToCopy = outputContent.innerText;
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = textToCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    copyButton.textContent = 'Tersalin!';
                    copyButton.classList.remove('bg-[#0f1d42]', 'hover:bg-opacity-75');
                    copyButton.classList.add('bg-green-600', 'hover:bg-green-700');
                } catch (err) {
                    copyButton.textContent = 'Gagal';
                    copyButton.classList.remove('bg-[#0f1d42]', 'hover:bg-opacity-75');
                    copyButton.classList.add('bg-red-600', 'hover:bg-red-700');
                }
                document.body.removeChild(tempTextArea);

                setTimeout(() => {
                    copyButton.textContent = 'Salin';
                    copyButton.classList.remove('bg-green-600', 'hover:bg-green-700', 'bg-red-600', 'hover:bg-red-700');
                    copyButton.classList.add('bg-[#0f1d42]', 'hover:bg-opacity-75');
                }, 2000);
            });
        });
    </script>
</body>
</html>
